from fastapi import FastAPI, HTTPException
import psycopg2
import os

app = FastAPI()

conn = psycopg2.connect(
    host=os.getenv("DB_HOST"),
    port=os.getenv("DB_PORT"),
    dbname=os.getenv("DB_NAME"),
    user=os.getenv("DB_USER"),
    password=os.getenv("DB_PASSWORD")
)
cursor = conn.cursor()

@app.post("/users")
def create_user(user: dict):
    cursor.execute(
        "INSERT INTO users (username, email) VALUES (%s, %s) RETURNING *",
        (user['username'], user['email'])
    )
    new_user = cursor.fetchone()
    conn.commit()
    return {"user": new_user}
